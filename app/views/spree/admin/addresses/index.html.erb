<% @parent_collection = (@order.class.name.split('::').last.humanize if @order) || (@user.class.name.split('::').last.humanize if @user) %>
<% if @order %>
  <%= render :partial => 'spree/admin/shared/order_tabs', :locals => { :current => 'Addresses' } %>
<% end %>

<% content_for :page_title do %>
  <% if @user && !@order %>
    <%= link_to "#{Spree.t(:editing_user)} #{@user.try(:email)}", edit_admin_user_url(@user) %>
  <% end %>
<% end %>

<% content_for :page_actions do %>
  <li><%= button_link_to I18n.t(:new_address, scope: :address_book), new_admin_address_path(user_id: @user.try(:id), order_id: @order.try(:id)), :icon => 'plus' %></li>
  <li><%= button_link_to "Back to #{@parent_collection}", redirect_back_admin_addresses_url(user_id: @user.try(:id), order_id: @order.try(:id)), :icon => 'arrow-left' %></li>
<% end %>

<fieldset data-hook="admin_addresses" id="admin_user_edit_addresses" class="alpha twelve columns">
  <legend><%= Spree.t('addresses', :scope => 'admin.user') %></legend>

  <% if @addresses.blank? %>
    <div class="alpha twelve columns no-objects-found">
      No Addresses found,
      <%= link_to "Add one", new_admin_address_path(user_id: @user.try(:id), order_id: @order.try(:id)) %>!
    </div>
  <% else %>
    <table id="addresses">
      <thead>
        <tr class="<%= cycle('even', 'odd') %>">
          <th><%= I18n.t(:address, scope: :address_book) %></th>
          <% if @user %>
            <th class="align-center"><%= I18n.t(:def_bill, scope: :address_book) %></th>
            <th class="align-center"><%= I18n.t(:def_ship, scope: :address_book) %></th>
          <% end %>
          <% if @order %>
            <th class="align-center"><%= I18n.t(:order_bill, scope: :address_book) %></th>
            <th class="align-center"><%= I18n.t(:order_ship, scope: :address_book) %></th>
          <% end %>
          <th class="actions"></th>
        </tr>
      </thead>

      <tbody>
      <%= form_for @user || @order, url: update_addresses_admin_addresses_path(user_id: @user.try(:id), order_id: @order.try(:id)), method: :put do |f| %>
        <% @addresses.each do |address| %>
          <tr class="<%= cycle('even', 'odd') %>" id="address-<%= address.id %>">
            <td><%= address %></td>
            <% if @user %>
              <td class="align-center">
                <%= radio_button_tag 'user[bill_address_id]',
                  address.user_bill.try(:id) || address.id,
                  address.user_bill.present? %>
                <%= label_tag "user_bill_address_id_#{address.id}", '' %>
              </td>
              <td class="align-center">
                <%= radio_button_tag 'user[ship_address_id]',
                  address.user_ship.try(:id) || address.id,
                  address.user_ship.present? %>
                <%= label_tag "user_ship_address_id_#{address.id}", '' %>
              </td>
            <% end %>
            <% if @order %>
              <td class="align-center">
                <%= radio_button_tag 'order[bill_address_id]',
                  address.order_bill.try(:id) || address.id,
                  address.order_bill.present? %>
                <%= label_tag "order_bill_address_id_#{address.id}", '' %>
              </td>
              <td class="align-center">
                <%= radio_button_tag 'order[ship_address_id]',
                  address.order_ship.try(:id) || address.id,
                  address.order_ship.present? %>
                <%= label_tag "order_ship_address_id_#{address.id}", '' %>
              </td>
            <% end %>
            <td class="actions">
              <%= link_to_edit_url edit_admin_address_url(address.primary_address, user_id: @user.try(:id), order_id: @order.try(:id)), no_text: true, id: "edit-address-#{address.id}" %>
            </td>
          </tr>
        <% end %>
        <div class="row">
          <div class="alpha twelve columns">
            <%= f.submit I18n.t(:update_default_addresses, scope: :address_book) %>
          </div>
        </div>
      <% end %>
      </tbody>
    </table>
  <% end %>
</fieldset>
